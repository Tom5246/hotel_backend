# 接口文档：易宿酒店预订平台 API

## 基础信息

基础URL: /api

请求格式：application/json

响应格式：application/json

字符集：UTF-8

认证方式：JWT（Bearer Token）

在需要认证的接口中，请求头需包含Authorization：Bearer <token>

## 通用响应结构

### 成功响应

```json
{
  "code": 200,
  "message": "success",
  "data": { ... } // 具体数据，也可能是数组或null
}
```

### 错误响应

```json
{
  "code": 400, // HTTP状态码或自定义错误码
  "message": "请求参数错误",
  "errors": [ // 可选，详细错误信息
    { "field": "name", "message": "酒店名称不能为空" }
  ]
}
```

## 认证接口

### 1. 用户注册

- URL: /auth/register
- Method: POST
- 权限: 公开

#### 请求体:

```json
{
  "username": "merchant01",
  "password": "123456",
  "email": "merchant@example.com",
  "phone": "13800138000",
  "role": "merchant" // 可选值: user, merchant, admin (默认为 user)
}
```

#### 响应:

```json
{
  "code": 200,
  "message": "注册成功",
  "data": {
    "id": 1,
    "username": "merchant01",
    "email": "merchant@example.com",
    "role": "merchant",
    "createdAt": "2026-02-20T10:00:00Z"
  }
}
```

### 2. 用户登录

- URL: /auth/login
- Method: POST
- 权限: 公开

#### 请求体:

```json
{
  "username": "merchant01",
  "password": "123456"
}
```

#### 响应:

```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expiresIn": 86400,
    "user": {
      "id": 1,
      "username": "merchant01",
      "role": "merchant"
    }
  }
}
```

### 3. 获取当前用户信息

- URL: /auth/profile
- Method: GET
- 权限: 需认证

#### 响应：

```json
{
  "code": 200,
  "data": {
    "id": 1,
    "username": "merchant01",
    "email": "merchant@example.com",
    "phone": "13800138000",
    "role": "merchant",
    "createdAt": "2026-02-20T10:00:00Z"
  }
}
```

## 酒店公共接口（移动端）

### 1. 查询酒店列表

- URL: /hotels
- Method: GET
- 权限: 公开

#### 查询参数(Query Parameters):

| 参数名 | 类型 | 必填 | 描述 | 示例 |
| --- | --- | --- | --- | --- |
| city | string | 否 | 城市名称（支持模糊） | 上海 |
| keyword | string | 否 | 关键字搜索（酒店名、地址） | 外滩 |
| checkIn | string | 否 | 入住日期(YYYY-MM-DD) | 2026-03-01 |
| checkOut | string | 否 | 离店日期(YYYY-MM-DD) | 2026-03-03 |
| star | string | 否 | 星级，逗号分隔 | 5,4 |
| priceMin | number | 否 | 最低价格 | 300 |
| priceMax | number | 否 | 最高价格 | 2000 |
| tags | string | 否 | 标签ID，逗号分隔 | 5,6 |
| sort | string | 否 | 排序字段：price_asc, price_desc, rating_desc, newest | price_asc |
| page | number | 否 | 页码，默认1 | 1 |
| pageSize | number | 否 | 每页数量，默认10，最大50 | 10 |

#### 响应：

```json
{
  "code": 200,
  "data": {
    "total": 100,
    "page": 1,
    "pageSize": 10,
    "items": [
      {
        "id": 1,
        "name": "上海外滩华尔道夫酒店",
        "address": "黄浦区中山东一路2号",
        "star": 5,
        "rating": 4.8,
        "reviewCount": 1234,
        "price": 1800, // 当前最低房型价格（根据查询日期实时计算）
        "image": "https://.../cover.jpg",
        "tags": ["江景", "奢华", "亲子"]
      }
    ]
  }
}
```

### 2. 获取酒店详情

- URL: /hotels/{hotelId}
- Method: GET
- 权限: 公开
- 路径参数: hotelId 酒店ID
- 查询参数:
  - checkIn (可选): 入住日期, 用于计算价格
  - checkOut (可选): 离店日期

#### 响应:

```json
{
  "code": 200,
  "data": {
    "id": 1,
    "name": "上海外滩华尔道夫酒店",
    "address": "黄浦区中山东一路2号",
    "description": "坐落于外滩...",
    "star": 5,
    "rating": 4.8,
    "openingDate": "2010-01",
    "images": [
      { "id": 101, "url": "https://.../image1.jpg", "type": "main" },
      { "id": 102, "url": "https://.../image2.jpg", "type": "room" }
    ],
    "tags": ["江景", "奢华", "亲子"],
    "rooms": [
      {
        "id": 201,
        "type": "豪华大床房",
        "area": 45,
        "bedType": "大床（1.8米）",
        "maxOccupancy": 2,
        "price": 1800, // 实时价格（根据checkIn/checkOut计算）
        "available": 5, // 剩余房间数
        "images": ["https://.../room1.jpg"],
        "amenities": ["浴缸", "迷你吧"]
      }
    ],
    "promotions": [ // 当前适用优惠
      {
        "id": 301,
        "title": "早鸟优惠",
        "description": "提前7天预订享8折",
        "discount": 0.8
      }
    ]
  }
}
```

### 3. 获取酒店价格日历

- URL: /hotels/{hotelId}/price-calendar
- Method: GET
- 权限: 公开
- 查询参数:
  - yearMonth (可选): 年月, 格式 YYYY-MM, 默认当前月

#### 响应:

```json
{
  "code": 200,
  "data": {
    "hotelId": 1,
    "yearMonth": "2026-03",
    "prices": [
      { "date": "2026-03-01", "lowestPrice": 1600, "available": true },
      { "date": "2026-03-02", "lowestPrice": 1600, "available": true }
    ]
  }
}
```

## 商户端接口（PC端，需认证，角色为 merchant）

### 1. 创建酒店

- URL: /merchant/hotels
- Method: POST
- 权限：商户

#### 请求体：

```json
{
  "name": "上海外滩酒店",
  "address": "黄浦区中山东一路1号",
  "description": "酒店描述...",
  "star": 5,
  "openingDate": "2018-06",
  "images": [
    { "url": "https://.../main.jpg", "type": "main" },
    { "url": "https://.../facility.jpg", "type": "facility" }
  ],
  "facilityIds": [1, 2, 3], // 设施ID列表
  "tagIds": [5, 6] // 标签ID列表
}
```

#### 响应：

```json
{
  "code": 201,
  "data": {
    "id": 1,
    "status": "pending", // 创建后状态为待审核
    "createdAt": "2026-02-20T12:00:00Z"
  }
}
```

### 2. 获取商户自己的酒店列表

- URL: /merchant/hotels
- Method: GET
- 权限：商户
- 查询参数：
  - status（可选）：过滤状态(pending, approved, rejected, published, unpublished)
  - page, pageSize

#### 响应：

```json
{
  "code": 200,
  "data": {
    "total": 5,
    "page": 1,
    "pageSize": 10,
    "items": [
      {
        "id": 1,
        "name": "上海外滩酒店",
        "status": "pending",
        "createdAt": "2026-02-20T12:00:00Z",
        "updatedAt": "2026-02-20T12:00:00Z"
      }
    ]
  }
}
```

### 3. 获取单个酒店信息

- URL: /merchant/hotels/{hotelId}
- Method: GET
- 权限: 商户（只能访问自己的酒店）

响应类似 GET /hotels/{hotelId}，但包含更多管理字段，如 status，auditComment 等。

#### 响应：

```json
{
  "code": 200,
  "data": {
    "id": 1,
    "name": "上海外滩酒店",
    "address": "黄浦区中山东一路1号",
    "description": "酒店描述...",
    "star": 5,
    "rating": 4.8,
    "openingDate": "2018-06",
    "merchantId": 101,
    "status": "pending", // 审核状态: pending, approved, rejected, published, unpublished
    "auditComment": "图片清晰，信息完整", // 审核意见（审核不通过时必有）
    "images": [
      { "id": 101, "url": "https://.../main.jpg", "type": "main" },
      { "id": 102, "url": "https://.../facility.jpg", "type": "facility" }
    ],
    "tags": ["江景", "奢华", "亲子"],
    "rooms": [
      {
        "id": 201,
        "type": "豪华大床房",
        "area": 45,
        "bedType": "大床（1.8米）",
        "maxOccupancy": 2,
        "price": 1800,
        "totalRooms": 10,
        "available": 5,
        "images": ["https://.../room1.jpg"],
        "amenities": ["浴缸", "迷你吧"]
      }
    ],
    "createdAt": "2026-02-20T12:00:00Z",
    "updatedAt": "2026-02-20T13:00:00Z"
  }
}
```

### 4. 更新酒店信息

- URL: /merchant/hotels/{hotelId}
- Method: PUT
- 权限: 商户

#### 请求体:

```json
{
  "name": "上海外滩酒店",
  "address": "黄浦区中山东一路1号",
  "description": "酒店描述...",
  "star": 5,
  "openingDate": "2018-06",
  "images": [
    { "url": "https://.../main.jpg", "type": "main" },
    { "url": "https://.../facility.jpg", "type": "facility" }
  ],
  "facilityIds": [1, 2, 3], // 设施ID列表
  "tagIds": [5, 6] // 标签ID列表
}
```

#### 响应：

```json
{
  "code": 200,
  "data": {
    "id": 1,
    "status": "pending", // 更新后重新进入待审核
    "updatedAt": "2026-02-20T13:00:00Z"
  }
}
```

### 5. 删除酒店

- URL: /merchant/hotels/{hotelId}
- Method: DELETE
- 权限：商户

#### 响应：

```json
{
  "code": 200,
  "message": "删除成功"
}
```

### 6. 房型管理

#### 6.1 添加房型

- URL: /merchant/hotels/{hotelId}/rooms
- Method: POST
- 权限: 商户（只能为自己名下的酒店添加房型）
- 路径参数: hotelId:酒店ID

##### 请求体:

```json
{
  "type": "豪华大床房",
  "area": 45,
  "bedType": "大床（1.8米）",
  "maxOccupancy": 2,
  "price": 1800,
  "totalRooms": 10,
  "images": ["https://.../room.jpg"],
  "amenities": ["浴缸", "迷你吧"]
}
```

##### 响应:

```json
{
  "code": 201,
  "data": {
    "id": 201,
    "hotelId": 1,
    "type": "豪华大床房",
    "area": 45,
    "bedType": "大床（1.8米）",
    "maxOccupancy": 2,
    "price": 1800,
    "totalRooms": 10,
    "available": 10,
    "images": ["https://.../room.jpg"],
    "amenities": ["浴缸", "迷你吧"],
    "createdAt": "2026-02-20T16:00:00Z",
    "updatedAt": "2026-02-20T16:00:00Z"
  }
}
```

#### 6.2 更新房型

- URL: /merchant/rooms/{roomId}
- Method: PUT
- 权限: 商户(只能更新自己酒店下的房型)
- 路径参数: roomId:房型ID
- 说明: 支持部分更新,请求体中的字段可选。

##### 请求体(示例,所有字段可选):

```json
{
  "type": "豪华大床房(升级版)",
  "price": 2000,
  "totalRooms": 8
}
```

##### 响应:

```json
{
  "code": 200,
  "data": {
    "id": 201,
    "hotelId": 1,
    "type": "豪华大床房(升级版)",
    "area": 45,
    "bedType": "大床(1.8米)",
    "maxOccupancy": 2,
    "price": 2000,
    "totalRooms": 8,
    "available": 8,
    "images": ["https://.../room.jpg"],
    "amenities": ["浴缸", "迷你吧"],
    "createdAt": "2026-02-20T16:00:00Z",
    "updatedAt": "2026-02-20T16:30:00Z"
  }
}
```

#### 6.3 删除房型

- URL: /merchant/hotels/{hotelId}/{roomId}
- Method: DELETE
- 权限: 商户（只能删除自己酒店下的房型）
- 路径参数:
  - hotelId: 酒店ID
  - roomId: 房型ID

##### 响应:

```json
{
  "code": 204,
  "message": "删除成功"
}
```

注: 也可返回200并携带数据, 但一般204更符合RESTful规范。

#### 6.4 查询房型列表

- URL: /merchant/hotels/{hotelId}/rooms
- Method: GET
- 权限: 商户（只能查看自己酒店下的房型）
- 路径参数: hotelId:酒店ID
- 查询参数:
  - page (可选):页码,默认1
  - pageSize (可选):每页数量,默认20,最大50

##### 响应:

```json
{
  "code": 200,
  "data": {
    "total": 3,
    "page": 1,
    "pageSize": 20,
    "items": [
      {
        "id": 201,
        "hotelId": 1,
        "type": "豪华大床房",
        "area": 45,
        "bedType": "大床 (1.8米)",
        "maxOccupancy": 2,
        "price": 1800,
        "totalRooms": 10,
        "available": 5,
        "images": ["https://.../room1.jpg"],
        "amenities": ["浴缸", "迷你吧"],
        "createdAt": "2026-02-20T16:00:00Z"
      },
      {
        "id": 202,
        "hotelId": 1,
        "type": "行政套房",
        "area": 80,
        "bedType": "特大床 (2米)",
        "maxOccupancy": 3,
        "price": 3500,
        "totalRooms": 5,
        "available": 2,
        "images": ["https://.../room2.jpg"],
        "amenities": ["浴缸", "客厅", "咖啡机"],
        "createdAt": "2026-02-20T16:05:00Z"
      }
    ]
  }
}
```

## 管理员接口（PC端，需认证，角色为 admin）

### 1. 获取待审核酒店列表

- URL: /admin/hotels/pending
- Method: GET
- 权限: 管理员
- 查询参数: page, pageSize

#### 响应：

```json
{
  "code": 200,
  "data": {
    "total": 10,
    "items": [
      {
        "id": 1,
        "name": "上海外滩酒店",
        "merchant": {
          "id": 2,
          "username": "merchant01"
        },
        "createdAt": "2026-02-20T12:00:00Z"
      }
    ]
  }
}
```

### 2. 审核酒店

- URL: /admin/hotels/{hotelId}/audit
- Method: POST
- 权限：管理员

#### 请求体：

```json
{
  "status": "approved", // 或 "rejected"
  "comment": "图片清晰，信息完整" // 审核意见，拒绝时必填
}
```

#### 响应：

```json
{
  "code": 200,
  "data": {
    "id": 1,
    "status": "approved"
  }
}
```

### 3. 上线/下线酒店

- URL: /admin/hotels/{hotelId}/publish
- Method: POST
- 权限：管理员

#### 请求体：

```json
{
  "action": "publish" // 或 "unpublish"
}
```

#### 响应:

```json
{
  "code": 200,
  "data": {
    "id": 1,
    "status": "published" // 或 "unpublished"
  }
}
```

### 4. 获取所有酒店

- URL: /admin/hotels
- Method: GET
- 权限: 管理员
- 查询参数:
  - status: pending (审核中), approved (审核通过), rejected (拒绝), published (上线), unpublished (下线)
  - merchantId: 按商户筛选
  - page, pageSize

#### 响应:

```json
{
  "code": 200,
  "data": {
    "total": 25,
    "page": 1,
    "pageSize": 10,
    "items": [
      {
        "id": 1,
        "name": "上海外滩酒店",
        "address": "黄浦区中山东一路1号",
        "star": 5,
        "rating": 4.8,
        "priceRange": { "min": 1800, "max": 5000 },
        "coverImage": "https://.../cover.jpg",
        "status": "published", // 当前状态
        "auditStatus": "approved", // 审核状态（可能和发布状态分开）
        "auditComment": "图片清晰，信息完整", // 最近一次审核意见
        "merchant": {
          "id": 101,
          "username": "merchant01",
          "email": "merchant@example.com",
          "phone": "13800138000"
        },
        "createdAt": "2026-02-18T10:00:00Z",
        "updatedAt": "2026-02-20T14:30:00Z"
      }
    ]
  }
}
```

## 预订接口

### 1. 创建预订

- URL: /reservations
- Method: POST
- 权限: 用户

#### 请求体:

```json
{
  "hotelId": 1,
  "roomId": 201,
  "checkIn": "2026-03-01",
  "checkOut": "2026-03-03",
  "guests": [
    {
      "firstName": "张三",
      "lastName": "三",
      "idType": "身份证",
      "idNumber": "110101199001011234",
      "phone": "13800138000"
    }
  ],
  "contactName": "张三",
  "contactPhone": "13800138000",
  "specialRequests": "需要高楼层",
  "promotionId": 301 // 可选, 使用的优惠ID
}
```

#### 响应：

```json
{
  "code": 201,
  "data": {
    "reservationId": "R202602201234",
    "totalPrice": 3600,
    "status": "confirmed",
    "createdAt": "2026-02-20T14:00:00Z"
  }
}
```

### 2. 查询预订列表

- URL: /reservations
- Method: GET
- 权限：用户
- 查询参数：status: confirmed, cancelled, completed

#### 响应:

```json
{
  "code": 200,
  "data": {
    "total": 3,
    "items": [
      {
        "id": "R202602201234",
        "hotelName": "上海外滩酒店",
        "roomType": "豪华大床房",
        "checkIn": "2026-03-01",
        "checkOut": "2026-03-03",
        "totalPrice": 3600,
        "status": "confirmed",
        "createdAt": "2026-02-20T14:00:00Z"
      }
    ]
  }
}
```

### 3. 取消预订

- URL: /reservations/{reservationId}
- Method: DELETE
- 权限: 用户

#### 响应:

```json
{
  "code": 200,
  "data": {
    "id": "R202602201234",
    "status": "cancelled"
  }
}
```

## 标签接口

### 1. 获取所有标签

- URL: /tags
- Method: GET
- 权限: 公开

#### 响应：

```json
{
  "code": 200,
  "data": [
    { "id": 1, "name": "亲子", "category": "theme" },
    { "id": 2, "name": "商务", "category": "theme" }
  ]
}
```

### 2. 创建标签（商户）

- URL: /tags
- Method: POST
- 权限: 商户

#### 请求体:

```json
{
  "name": "江景",
  "category": "view"
}
```

## 入住人员接口

### 1. 创建入住人员信息

- URL: /guests
- Method: POST
- 权限: 需认证（保存常用入住人）

#### 请求体:

```json
{
  "firstName": "李",
  "lastName": "四",
  "idType": "身份证",
  "idNumber": "110101199002022345",
  "phone": "13900139000"
}
```

### 2. 获取常用入住人列表

- URL: /guests
- Method: GET
- 权限: 需认证 (仅返回当前用户的入住人)
- 请求参数: page (默认1), pageSize (默认10)

#### 响应体:

```json
{
  "code": 200,
  "data": {
    "total": 5,
    "page": 1,
    "pageSize": 10,
    "items": [
      {
        "id": 1001,
        "firstName": "李",
        "lastName": "四",
        "idType": "身份证",
        "idNumber": "110101199002022345",
        "phone": "13900139000",
        "createdAt": "2026-02-20T15:30:00Z"
      },
      {
        "id": 1002,
        "firstName": "王",
        "lastName": "五",
        "idType": "护照",
        "idNumber": "E12345678",
        "phone": "13800138001",
        "createdAt": "2026-02-19T10:20:00Z"
      }
    ]
  }
}
```

### 3. 删除入住人

- URL: /guests/{guestId}
- Method: DELETE
- 权限: 需认证（只能删除自己的入住人）

#### 响应体：

```json
{
  "code": 200,
  "message": "删除成功"
}
```

## 附录：数据库表设计